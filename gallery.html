<!-- =========================
GFI Gallery Fix (Drop-in)
Files touched: gallery.html, style.css, /assets/js/gallery.js
Assumes images live at /assets/gallery/education1.jpg and education2.jpg
Root-relative paths throughout; ensure NO <base> tag exists in <head>.
========================= -->

<!-- ===== gallery.html (replace the <main>...</main> block on this page) ===== -->
<main id="content" class="container">
  <section id="gallery" class="gallery">
    <header class="gallery-header">
      <h1>Gallery</h1>
      <p class="muted">Tap an album to view photos. Images are loaded from <code>/assets/gallery/</code>.</p>
    </header>

    <div class="albums">
      <!-- Album: Education Outreach -->
      <button
        class="album-card"
        aria-label="Open Education Outreach album"
        data-album="education-outreach"
        data-title="Education Outreach"
        data-images="/assets/gallery/education1.jpg,/assets/gallery/education2.jpg"
      >
        <div class="album-thumb">
          <img src="/assets/gallery/education1.jpg" alt="Education Outreach" loading="lazy">
        </div>
        <div class="album-meta">
          <h3>Education Outreach</h3>
          <span class="count">2 photos</span>
        </div>
      </button>

      <!-- Starter album cards (use real images later) -->
      <button
        class="album-card"
        aria-label="Open Sustainable Agriculture album"
        data-album="sustainable-agriculture"
        data-title="Sustainable Agriculture"
        data-images="/assets/gallery/agriculture1.jpg,/assets/gallery/agriculture2.jpg"
      >
        <div class="album-thumb placeholder"></div>
        <div class="album-meta">
          <h3>Sustainable Agriculture</h3>
          <span class="count">2+ photos</span>
        </div>
      </button>

      <button
        class="album-card"
        aria-label="Open Green Dignity Villages album"
        data-album="green-dignity-villages"
        data-title="Green Dignity Villages"
        data-images="/assets/gallery/gdv1.jpg,/assets/gallery/gdv2.jpg"
      >
        <div class="album-thumb placeholder"></div>
        <div class="album-meta">
          <h3>Green Dignity Villages</h3>
          <span class="count">2+ photos</span>
        </div>
      </button>
    </div>

    <!-- Lightbox Modal -->
<dialog id="lightbox" class="lightbox" aria-modal="true">
  <div class="lightbox-header">
    <h2 id="lightbox-title">Album</h2>
    <button id="lightbox-close" class="close" aria-label="Close">×</button>
  </div>
  <div class="lightbox-body">
    <button class="nav prev" aria-label="Previous">‹</button>
    <img id="lightbox-image" alt="Album image" />
    <button class="nav next" aria-label="Next">›</button>
  </div>
  <div class="lightbox-footer">
    <span id="lightbox-counter" class="counter">1 / 1</span>
  </div>
</dialog>
  </section>
</main>
<!-- ===== style.css (append these rules to the end of /style.css) ===== -->
<style>
/* --- Gallery layout --- */
.gallery { padding: 2rem 0; }
.gallery-header h1 { margin: 0 0 .25rem 0; }
.gallery-header .muted { color: #777; font-size: .95rem; }

.albums { display: grid; grid-template-columns: 1fr; gap: 1rem; }
@media (min-width: 640px) { .albums { grid-template-columns: 1fr 1fr; } }
@media (min-width: 1024px) { .albums { grid-template-columns: 1fr 1fr 1fr; } }

.album-card { display: grid; grid-template-rows: auto 1fr; gap: .5rem; padding: .75rem; border: 1px solid #e4e4e4; border-radius: 14px; background: #fff; cursor: pointer; text-align: left; }
.album-card:focus-visible { outline: 3px solid #2a7; }
.album-thumb { aspect-ratio: 4/3; overflow: hidden; border-radius: 10px; background: #f5f5f5; display:flex; align-items:center; justify-content:center; }
.album-thumb img { width: 100%; height: 100%; object-fit: contain; /* show full people, no cropping */ }
.album-thumb.placeholder::after { content: "Image"; color: #aaa; font-size: .9rem; }
.album-meta h3 { margin: 0; font-size: 1.05rem; }
.album-meta .count { color: #666; font-size: .9rem; }

/* --- Lightbox --- */
.lightbox { width: min(100%, 980px); border: none; border-radius: 16px; padding: 0; }
.lightbox::backdrop { background: rgba(0,0,0,.65); }
.lightbox-header { display: flex; align-items: center; justify-content: space-between; padding: .75rem 1rem; border-bottom: 1px solid #eee; }
.lightbox-body { position: relative; padding: 1rem; display: grid; place-items: center; }
.lightbox-body img { max-width: 100%; max-height: 70vh; object-fit: contain; background: #000; border-radius: 12px; }
.lightbox-footer { padding: .5rem 1rem 1rem; text-align: right; color: #555; }

.lightbox .close { background: transparent; border: none; font-size: 1.5rem; line-height: 1; cursor: pointer; }
.lightbox .nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,.5); color: #fff; border: none; font-size: 2rem; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; display: grid; place-items: center; }
.lightbox .nav.prev { left: .5rem; }
.lightbox .nav.next { right: .5rem; }

/* Improve dialog support on Safari/iOS (non-modal fallback) */
@supports not (backdrop-filter: blur(0)) { .lightbox { max-width: 100%; } }
</style>


<!-- ===== /assets/js/gallery.js (create this new file) ===== -->
<script>
(function() {
  const cards = document.querySelectorAll('.album-card');
  const dlg = document.getElementById('lightbox');
  const imgEl = document.getElementById('lightbox-image');
  const titleEl = document.getElementById('lightbox-title');
  const counterEl = document.getElementById('lightbox-counter');
  const btnClose = document.getElementById('lightbox-close');
  const btnPrev = dlg.querySelector('.nav.prev');
  const btnNext = dlg.querySelector('.nav.next');
<script src="/assets/js/gallery.js" defer></script>
  /** Robustly parse CSV list, trimming spaces and ignoring empties */
  function parseImages(csv) {
    return (csv || '')
      .split(',')
      .map(s => s.trim())
      .filter(Boolean);
  }

  /** Lightbox state */
  let images = [];
  let idx = 0;

  function show(i) {
    if (!images.length) return;
    idx = (i + images.length) % images.length; // wrap around
    imgEl.src = images[idx];
    imgEl.alt = titleEl.textContent + ' — ' + (idx + 1);
    counterEl.textContent = (idx + 1) + ' / ' + images.length;
  }

  function openAlbum(card) {
    images = parseImages(card.getAttribute('data-images'));
    titleEl.textContent = card.getAttribute('data-title') || 'Album';
    if (!images.length) {
      alert('No images found for this album.');
      return;
    }
    show(0);
    if (typeof dlg.showModal === 'function') dlg.showModal();
    else dlg.setAttribute('open', ''); // fallback
  }

  cards.forEach(card => {
    card.addEventListener('click', () => openAlbum(card));
    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openAlbum(card); }
    });
  });

  btnClose.addEventListener('click', () => dlg.close && dlg.close());
  dlg.addEventListener('click', (e) => {
    if (e.target === dlg) dlg.close && dlg.close();
  });

  btnPrev.addEventListener('click', () => show(idx - 1));
  btnNext.addEventListener('click', () => show(idx + 1));
  document.addEventListener('keydown', (e) => {
    if (!dlg.open) return;
    if (e.key === 'Escape') dlg.close && dlg.close();
    if (e.key === 'ArrowLeft') show(idx - 1);
    if (e.key === 'ArrowRight') show(idx + 1);
  });
})();
</script>

